generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// =============================
// ðŸ“‹ MASTER DATA
// =============================
model Atasan {
  id       Int       @id @default(autoincrement())
  nama     String
  bawahan  Jabatan[] @relation("AtasanRelation")

  @@map("atasan")
}

model Jabatan {
  id         Int      @id @default(autoincrement())
  nama       String
  atasan_id  Int?
  atasan     Atasan?  @relation("AtasanRelation", fields: [atasan_id], references: [id])
  users      Users[]

  @@map("jabatan")
}

model Users {
  id           Int       @id @default(autoincrement())
  nik          String    @unique
  nama         String
  jabatan_id   Int?
  divisi       String?
  status       String?
  telp         String?
  tmm_tmt      DateTime?
  role         Role      @default(karyawan)
  password     String
  jabatan      Jabatan?  @relation(fields: [jabatan_id], references: [id])
  izin         Izin[]    @relation("UserIzin")
  verifikasi   VerifikasiIzin[] @relation("Verifikator")

  @@map("users")
}

//
// =============================
// ðŸ•’ IZIN & VERIFIKASI
// =============================
model JenisIzin {
  id          Int     @id @default(autoincrement())
  nama_izin   String
  keterangan  String?
  izin        Izin[]

  @@map("jenis_izin")
}

model Izin {
  id                    Int       @id @default(autoincrement())
  user_id               Int
  jenis_izin_id         Int
  tanggal_pengajuan     DateTime? @default(now())
  tanggal_mulai         DateTime
  tanggal_selesai       DateTime
  tanggal_masuk_kembali DateTime?
  jumlah_hari           Int?
  keperluan             String?
  bukti                 String?
  status_izin           StatusIzin @default(diajukan)

  user        Users      @relation("UserIzin", fields: [user_id], references: [id])
  jenis_izin  JenisIzin  @relation(fields: [jenis_izin_id], references: [id])
  verifikasi  VerifikasiIzin[]

  @@map("izin")
}

model VerifikasiIzin {
  id                 Int       @id @default(autoincrement())
  izin_id            Int
  verifikator_id     Int
  status_verifikasi  StatusVerifikasi @default(menunggu)
  tanggal_verifikasi DateTime? @default(now())
  catatan            String?

  izin        Izin  @relation(fields: [izin_id], references: [id])
  verifikator Users @relation("Verifikator", fields: [verifikator_id], references: [id])

  @@map("verifikasi_izin")
}

//
// =============================
// ðŸ§© ENUM
// =============================
enum Role {
  admin
  karyawan
  hrd
  kepala_sekolah
}

enum StatusIzin {
  diajukan
  disetujui
  ditolak
}

enum StatusVerifikasi {
  menunggu
  disetujui
  ditolak
}
